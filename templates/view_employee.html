<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Employee Table with CSV Export</title>
    <!-- DataTables CSS -->
    <link rel="stylesheet" href="https://cdn.datatables.net/2.1.8/css/dataTables.dataTables.min.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/buttons/3.1.2/css/buttons.dataTables.min.css">

    <style>
      .btn-outline-primary {
        color: purple !important;
        border-color: purple !important;
      }
      .btn-outline-primary:hover {
        background-color: purple !important;
        color: white !important;
      }
    </style>
</head>
<body>
    {% include 'left_nav.html' %}
    <a href="/add_employees" class="btn btn-outline-primary mb-2">Add employees</a>
    <!-- Table -->
    <table class="table table-striped table-bordered table-light" id="idle">
        <thead>
            <tr>
                <th>#</th>
                <th>Name</th>
                <th>Email</th>
                <th>Joining Date</th>
                <th>Mobile</th>
                <th>Password</th>
                <th colspan="3">Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for i in data %}
            <tr>
                <td>{{ forloop.counter }}</td>
                <td>{{ i.name }}</td>
                <td>{{ i.email }}</td>
                <td>{{ i.joining_date }}</td>
                <td>{{ i.mobile }}</td>
                <td>{{ i.password }}</td>
                <td><a href="/login_info_emp/{{ i.id }}" class="btn btn-outline-primary">Login info</a></td>
                <td><a href="/edit_emp/{{ i.id }}" class="btn btn-outline-primary">Edit</a></td>
                <td><a href="/delete_emp/{{ i.id }}" class="btn btn-outline-primary">Delete</a></td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <!-- CSV Download Button -->
    <button id="downloadCsvBtn" class="btn btn-outline-primary mb-2">Download CSV</button>

    <!-- Load jQuery first -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>    <!-- DataTables JS -->
    <script src="https://cdn.datatables.net/2.1.8/js/dataTables.min.js"></script>
    <!-- DataTables Buttons extension -->
    <script src="https://cdn.datatables.net/buttons/3.1.2/js/dataTables.buttons.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.1.0/js/buttons.html5.min.js"></script>

    <script>
        $(document).ready(function() {
            // Initialize DataTable with buttons plugin
            var table = $('#idle').DataTable({
                dom: 'Bfrtip',  // Position for buttons (buttons, filters, etc.)
                buttons: [
                    {
                        extend: 'csvHtml5',   // Export to CSV
                        text: 'Download CSV', // Button text
                        filename: 'table_data' // File name for the downloaded CSV
                    }
                ]
            });

            // Custom CSV Download Function
            $('#downloadCsvBtn').click(function () {
                exportTableToCSV('table_data.csv');
            });

            function exportTableToCSV(filename) {
                var csv = [];
                var rows = document.querySelectorAll("#idle tr");

                for (var i = 0; i < rows.length; i++) {
                    var row = [], cols = rows[i].querySelectorAll("td, th");

                    for (var j = 0; j < cols.length; j++) {
                        row.push(cols[j].innerText);
                    }

                    csv.push(row.join(","));
                }

                // Download CSV
                var csvFile = new Blob([csv.join("\n")], { type: "text/csv" });
                var downloadLink = document.createElement("a");
                downloadLink.download = filename;
                downloadLink.href = window.URL.createObjectURL(csvFile);
                downloadLink.style.display = "none";
                document.body.appendChild(downloadLink);
                downloadLink.click();
            }
        });
    </script>
</body>
</html>
